<script src="http://js.pusherapp.com/1.8/pusher.min.js" type="text/javascript"></script>
<script type="text/javascript">
  // Enable pusher logging - don't include this in production
  Pusher.log = function(message) {
    if (window.console && window.console.log) window.console.log(message);
  };

  // Flash fallback logging - don't include this in production
  WEB_SOCKET_DEBUG = true;

  var pusher = new Pusher('83cad248adce476e852e');
  <% if @board %>
  var channel = pusher.subscribe('<%= "board-#{@board.id}" %>');
  channel.bind('created', function(data) {
    create_note_at_dom(data.note, $('#field_' + data.note.note.field_id), window.current_user == data.user);
  });
  channel.bind('destroyed', function(data){
		delete_note(data.note.id);
	});
	channel.bind('updated', function(data){
		update_note(data);
	});
	channel.bind('resize-field', function(data){
		update_fields(data);
	});
	channel.bind('split-field', function(data){
		_.each(data.fields, function(field){
			field = field.field;
			var $field = $('#field_' + field.id);
			if($field.length == 0){
				$field = $('.field').first().clone();
				$field.id = '#field_' + field.id;
				$field.html('');
				$('.board_div').append($field);
				$field.css({
	    		'height': field.height,
		      'width': field.width,
		      'top': field.position_y,
		      'left': field.position_x
		    });
				attach_field_handlers($field);
				
			}else
			{
				$field.css({
	    		'height': field.height,
		      'width': field.width,
		      'top': field.position_y,
		      'left': field.position_x
		    });
			}
			
			
			
		})
	});
	window.current_user = <%= current_user.id %>
	<% end %>
</script>